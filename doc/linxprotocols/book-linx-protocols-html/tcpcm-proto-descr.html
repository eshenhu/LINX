<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7.1 TCP CM Protocol Descriptions</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><meta name="keywords" content=""><link rel="start" href="title.html" title="LINX Protocols"><link rel="up" href="tcp_cm_manager.html" title="7. Enea LINX TCP Connection Manager"><link rel="prev" href="tcp_cm_manager.html" title="7. Enea LINX TCP Connection Manager"><link rel="next" href="gtw-protocol.html" title="8. Enea LINX Gateway Protocol"><base target="body"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="2" align="left"><span class="headerbaseline">Document Version 21</span></td><td align="right"><IMG src="images/enea_logo.png"></td></tr><tr><td colspan="3" align="center" valign="bottom"><h2 class="title"><a name="book_linx_proto"></a>LINX Protocols</h2></td></tr><tr><td width="20%" align="left"><a accesskey="p" href="tcp_cm_manager.html">Prev</a> </td><th width="60%" align="center">7. Enea LINX TCP Connection Manager</th><td width="20%" align="right"> <a accesskey="n" href="gtw-protocol.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tcpcm-proto-descr"></a>7.1 TCP CM Protocol Descriptions</h2></div></div></div><p>With the Enea LINX TCP Connection Manager Protocol, a connection is
    established in the following manner.</p><div class="itemizedlist"><ul type="disc"><li><p>The TCP CM listens on port 19790 by default. Node A wants to
        connect to node B. A creates a TCP socket and connects it to B, sends
        a TCP_CONN message and then waits for a randomly amount of time for an
        acknowledgement. If an acknowledgment is not received, A will restart
        the connection procedure.</p></li><li><p>B accepts the socket and when B wants to connect to A, it will
        lookup the previously accepted socket and read the TCP_CONN header.
        Then, it will send an acknowledgement TCP_CONN header to A.</p></li><li><p>B considers the connection established if the send was
        successful and then notifies the upper layer of the established
        connection.</p></li><li><p>A receives the TCP_CONN header and notifies the upper layer of
        the connection.</p></li></ul></div><p>If both nodes try to connect to each other at the same time, neither
    of the nodes will receive an acknowledgment since the headers are sent on
    different sockets. This will lead to retries of the connection procedure.
    The timeouts for the retries are random.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2622802"></a>7.1.1 TCP Connection Manager Headers</h3></div></div></div><p>The Enea LINX TCP Connection Manager protocol defines the
      following header and package types.</p><div class="table"><a name="tcpcm-protonumbers"></a><p class="title"><b>Table 7.1 TCP Connection Manager Protocol Header Types</b></p><div class="table-contents"><table summary="TCP Connection Manager Protocol Header Types" cellpadding="5" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td>Protocol number</td><td>Value</td><td>Definition</td></tr><tr><td>TCP_CONN</td><td>0x43</td><td>Connect type. Used for connection acknowledgement</td></tr><tr><td>TCP_UDATA</td><td>0x55</td><td>User data type</td></tr><tr><td>TCP_PING</td><td>0x50</td><td>Keep-alive header type</td></tr><tr><td>TCP_PONG</td><td>0x51</td><td>Keep-alive response header type</td></tr></tbody></table></div></div><br class="table-break"><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2622914"></a>7.1.1.1 TCP CM Generic Header</h4></div></div></div><p>All messages in the TCP CM protocol have the following header.
        Only if Type indicates TCP_UDATA the fields source and destination are
        used - otherwise they must be set to zero. The size field is always
        used in the TCP_UDATA header and it may also be used in the TCP_CONN
        header.</p><div class="table"><a name="id2622929"></a><p class="title"><b>Table 7.2 TCPCM Generic Header</b></p><div class="table-contents"><table summary="TCPCM Generic Header" cellpadding="5" border="1"><colgroup><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col></colgroup><tbody><tr><td><sup>0</sup></td><td><sup>1</sup></td><td><sup>2</sup></td><td><sup>3</sup></td><td><sup>4</sup></td><td><sup>5</sup></td><td><sup>6</sup></td><td><sup>7</sup></td><td><sup>8</sup></td><td><sup>9</sup></td><td><sup>10</sup></td><td><sup>11</sup></td><td><sup>12</sup></td><td><sup>13</sup></td><td><sup>14</sup></td><td><sup>15</sup></td><td><sup>16</sup></td><td><sup>17</sup></td><td><sup>18</sup></td><td><sup>19</sup></td><td><sup>20</sup></td><td><sup>21</sup></td><td><sup>22</sup></td><td><sup>23</sup></td><td><sup>24</sup></td><td><sup>25</sup></td><td><sup>26</sup></td><td><sup>27</sup></td><td><sup>28</sup></td><td><sup>29</sup></td><td><sup>30</sup></td><td><sup>31</sup></td></tr><tr><td colspan="8" align="center">0</td><td colspan="8" align="center">1</td><td colspan="8" align="center">2</td><td colspan="8" align="center">3</td></tr><tr><td colspan="15" align="center">Reserved</td><td>O</td><td colspan="8" align="center">Version</td><td colspan="8" align="center">Type</td></tr><tr><td colspan="32" align="center">Source</td></tr><tr><td colspan="32" align="center">Destination</td></tr><tr><td colspan="32" align="center">Size</td></tr></tbody></table></div></div><br class="table-break"><div class="variablelist"><dl><dt><span class="term">Reserved</span></dt><dd><p>Reserved for future use, must be 0.</p></dd><dt><span class="term">O</span></dt><dd><p>OOB bit, the TCP_UDATA is out of band.<a class="indexterm" name="id2623426"></a></p></dd><dt><span class="term">Version</span></dt><dd><p>Version of the TCP CM protocol.</p></dd><dt><span class="term">Type</span></dt><dd><p>Type of the current packet</p></dd><dt><span class="term">Source</span></dt><dd><p>Source link id. Used in type TCP_UDATA, otherwise
              0.</p></dd><dt><span class="term">Destination</span></dt><dd><p>Destination link id. Used in type TCP_UDATA, otherwise
              0.</p></dd><dt><span class="term">Size</span></dt><dd><p>Size of user data in bytes, followed by the header. Used
              in type TCP_UDATA and TCP_CONN, otherwise 0.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2623510"></a>7.1.1.2 TCP CM TCP_UDATA Header</h4></div></div></div><p>All messages that don't originate from the Connection Manager
        are sent as TCP_UDATA. The user data is preceded by the TCP CM header
        with type TCP_UDATA.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2623524"></a>7.1.2 TCP CM Connection Supervision Protocol</h3></div></div></div><p>The two endpoints of a connection <a class="indexterm" name="id2623533"></a>send TCP_PING headers to one another every configurable
      amount of milliseconds (default is 1000). When an endpoint receives a
      TCP_PING header, it will respond by sending a TCP_PONG header to the
      peer. If the connection goes down in any way, this will be detected and
      the CM will report this to the upper layer.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tcp_cm_manager.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="tcp_cm_manager.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="gtw-protocol.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"><b>7. Enea LINX TCP Connection Manager</b> </td><td width="20%" align="center"><a accesskey="h" href="title.html">Home</a> | <a accesskey="i" href="ix01.html">Index</a></td><td width="40%" align="right" valign="top"> <b>8. Enea LINX Gateway Protocol</b></td></tr><tr> </tr><tr><td colspan="3" align="center">© Enea Software AB 2011</td></tr></table></div></body></html>
