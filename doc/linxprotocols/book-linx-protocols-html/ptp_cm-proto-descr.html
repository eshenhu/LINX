<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>6.1 Protocol Description</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><meta name="keywords" content=""><link rel="start" href="title.html" title="LINX Protocols"><link rel="up" href="ptp_cm_manager.html" title="6. Enea LINX Point-To-Point (PTP) Connection Manager"><link rel="prev" href="ptp_cm_manager.html" title="6. Enea LINX Point-To-Point (PTP) Connection Manager"><link rel="next" href="tcp_cm_manager.html" title="7. Enea LINX TCP Connection Manager"><base target="body"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="2" align="left"><span class="headerbaseline">Document Version 21</span></td><td align="right"><IMG src="images/enea_logo.png"></td></tr><tr><td colspan="3" align="center" valign="bottom"><h2 class="title"><a name="book_linx_proto"></a>LINX Protocols</h2></td></tr><tr><td width="20%" align="left"><a accesskey="p" href="ptp_cm_manager.html">Prev</a> </td><th width="60%" align="center">6. Enea LINX Point-To-Point (PTP) Connection Manager</th><td width="20%" align="right"> <a accesskey="n" href="tcp_cm_manager.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ptp_cm-proto-descr"></a>6.1 Protocol Description</h2></div></div></div><p>Enea LINX PDUs are stacked in front of, possible, user data to form
    an Enea LINX packet. All PDUs contain a "next header" field which
    indicates the type of the next PDU to be sent. Everything from the
    transmit() down call, including possible control plane signaling, from the
    RLNH layer is sent reliably as user data. The first field in all headers
    is the current type, followed by "next" field.</p><p>If a malformed packet is received the PTP Connection Manager resets
    the connection and informs RLNH.</p><p>When the PTP Connection Manager encounters problems which prevents
    delivery of a message or part of a message it must reset the connection.
    If the peer replies with RESET, or if the peer has crashed and the
    Connection Supervision timer fires, the PTP CM will notify the
    RLNH.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2620283"></a>6.1.1 Enea LINX Point-To-Point Connection Manager Headers</h3></div></div></div><p>The Enea LINX Point-To-Point Connection Manager protocol defines
      these headers.</p><div class="table"><a name="ptpcm-protonumbers"></a><p class="title"><b>Table 6.1 PTP Connection Manager Protocol Headers</b></p><div class="table-contents"><table summary="PTP Connection Manager Protocol Headers" cellpadding="5" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td>Protocol number</td><td>Value</td><td>Definition</td></tr><tr><td>PTP_CM_MAIN</td><td>0x01</td><td>Main header sent first.</td></tr><tr><td>PTP_CM_CONN_RESET</td><td>0x02</td><td>Reset header. Used to notify the remote side that the
              connection will be torn down and reinitialized.</td></tr><tr><td>PTP_CM_CONN_CONNECT</td><td>0x03</td><td>Connect header. Used to establish connections.</td></tr><tr><td>PTP_CM_CONN_CONNECT_ACK</td><td>0x04</td><td>Notify remote side that connection was
              established.</td></tr><tr><td>PTP_CM_UDATA</td><td>0x05</td><td>All messages generated outside the Connection Manager are
              send as UDATA.</td></tr><tr><td>PTP_CM_FRAG</td><td>0x06</td><td>Fragment header. Messages larger than MTU are fragmented
              into several packages. The first fragmented package has a
              PTP_CM_UDATA header followed by PTP_CM_FRAG header, the
              following packages has only PDU PTP_CM_FRAG.</td></tr><tr><td>PTP_CM_HEARTBEAT</td><td>0x07</td><td>Header for heart beat control messages. These messages
              are used to discover a connection failure.</td></tr><tr><td>PTP_CM_HEARTBEAT_ACK</td><td>0x08</td><td>Acknowledgement header for heartbeat messages. Sent as a
              reply to PTP_CM_HEARTBEAT messages.</td></tr><tr><td>PTP_CM_NONE</td><td>0xFF</td><td>Indicates that the current header is the last in the
              PDU.</td></tr></tbody></table></div></div><br class="table-break"><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2620476"></a>6.1.1.1 PTP_CM_MAIN Header</h4></div></div></div><p>All messages originating outside the Connection Manger begin
        with MAIN header. This header specify the type of the next header to
        come.</p><div class="table"><a name="id2620489"></a><p class="title"><b>Table 6.2 PTP_CM Main header</b></p><div class="table-contents"><table summary="PTP_CM Main header" cellpadding="5" border="1"><colgroup><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col></colgroup><tbody><tr><td><sup>0</sup></td><td><sup>1</sup></td><td><sup>2</sup></td><td><sup>3</sup></td><td><sup>4</sup></td><td><sup>5</sup></td><td><sup>6</sup></td><td><sup>7</sup></td><td><sup>8</sup></td><td><sup>9</sup></td><td><sup>10</sup></td><td><sup>11</sup></td><td><sup>12</sup></td><td><sup>13</sup></td><td><sup>14</sup></td><td><sup>15</sup></td><td><sup>16</sup></td><td><sup>17</sup></td><td><sup>18</sup></td><td><sup>19</sup></td><td><sup>20</sup></td><td><sup>21</sup></td><td><sup>22</sup></td><td><sup>23</sup></td><td><sup>24</sup></td><td><sup>25</sup></td><td><sup>26</sup></td><td><sup>27</sup></td><td><sup>28</sup></td><td><sup>29</sup></td><td><sup>30</sup></td><td><sup>31</sup></td></tr><tr><td colspan="8" align="center">0</td><td colspan="8" align="center">1</td><td colspan="8" align="center">2</td><td colspan="8" align="center">3</td></tr><tr><td colspan="8">Next Header Type</td><td colspan="24" align="center"> </td></tr></tbody></table></div></div><p><br class="table-break"></p><div class="variablelist"><dl><dt><span class="term">Next Header Type</span></dt><dd><p>Specify what type of PDU will be next.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2620918"></a>6.1.1.2 PTP_CM_UDATA Header</h4></div></div></div><p>All messages originating outside the Connection Manger are sent
        as USER_DATA. There are two types of USER_DATA header. The first type
        is used for messages not requiring fragmentation and for the first
        fragment of fragmented messages. The second type - PTP_CM_FRAG is used
        for all remaining fragments.</p><div class="table"><a name="id2620932"></a><p class="title"><b>Table 6.3 PTP_CM User Data Header</b></p><div class="table-contents"><table summary="PTP_CM User Data Header" cellpadding="5" border="1"><colgroup><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col></colgroup><tbody><tr><td><sup>0</sup></td><td><sup>1</sup></td><td><sup>2</sup></td><td><sup>3</sup></td><td><sup>4</sup></td><td><sup>5</sup></td><td><sup>6</sup></td><td><sup>7</sup></td><td><sup>8</sup></td><td><sup>9</sup></td><td><sup>10</sup></td><td><sup>11</sup></td><td><sup>12</sup></td><td><sup>13</sup></td><td><sup>14</sup></td><td><sup>15</sup></td><td><sup>16</sup></td><td><sup>17</sup></td><td><sup>18</sup></td><td><sup>19</sup></td><td><sup>20</sup></td><td><sup>21</sup></td><td><sup>22</sup></td><td><sup>23</sup></td><td><sup>24</sup></td><td><sup>25</sup></td><td><sup>26</sup></td><td><sup>27</sup></td><td><sup>28</sup></td><td><sup>29</sup></td><td><sup>30</sup></td><td><sup>31</sup></td></tr><tr><td colspan="8" align="center">0</td><td colspan="8" align="center">1</td><td colspan="8" align="center">2</td><td colspan="8" align="center">3</td></tr><tr><td colspan="8">Next Header Type</td><td colspan="24" align="center">Total
                Size</td></tr><tr><td colspan="8">Total Size</td><td colspan="24" align="center">Upper layer
                data 1</td></tr><tr><td colspan="8">Upper layer data 1</td><td colspan="24" align="center">Upper layer
                data 2</td></tr><tr><td colspan="8">Upper layer data 2</td><td colspan="24" align="center"> </td></tr></tbody></table></div></div><br class="table-break"><div class="variablelist"><dl><dt><span class="term">Next Header Type</span></dt><dd><p>Specify what header type will follow in the current
              PDU.</p></dd><dt><span class="term">Total Size</span></dt><dd><p>Size of user data to be sent. If the size exceeds MTU,
              there message will be fragmented.</p></dd><dt><span class="term">Upper layer data 1</span></dt><dd><p>Source address. CM does not modify this field.</p></dd><dt><span class="term">Upper layer data 2</span></dt><dd><p>Destination address. CM does not modify this field.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2621469"></a>6.1.1.3 PTP_CM_FRAG Head</h4></div></div></div><p>At destination, fragments will be expected to arrive in order,
        but may be interrupted by other packets, and the message will be
        re-composed based on total size information.</p><div class="table"><a name="id2621481"></a><p class="title"><b>Table 6.4 PTP_CM Fragment Header</b></p><div class="table-contents"><table summary="PTP_CM Fragment Header" cellpadding="5" border="1"><colgroup><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col></colgroup><tbody><tr><td><sup>0</sup></td><td><sup>1</sup></td><td><sup>2</sup></td><td><sup>3</sup></td><td><sup>4</sup></td><td><sup>5</sup></td><td><sup>6</sup></td><td><sup>7</sup></td><td><sup>8</sup></td><td><sup>9</sup></td><td><sup>10</sup></td><td><sup>11</sup></td><td><sup>12</sup></td><td><sup>13</sup></td><td><sup>14</sup></td><td><sup>15</sup></td><td><sup>16</sup></td><td><sup>17</sup></td><td><sup>18</sup></td><td><sup>19</sup></td><td><sup>20</sup></td><td><sup>21</sup></td><td><sup>22</sup></td><td><sup>23</sup></td><td><sup>24</sup></td><td><sup>25</sup></td><td><sup>26</sup></td><td><sup>27</sup></td><td><sup>28</sup></td><td><sup>29</sup></td><td><sup>30</sup></td><td><sup>31</sup></td></tr><tr><td colspan="8" align="center">0</td><td colspan="8" align="center">1</td><td colspan="8" align="center">2</td><td colspan="8" align="center">3</td></tr><tr><td colspan="8">Next Header Type</td><td colspan="24" align="center">Size</td></tr><tr><td colspan="8">Size</td><td colspan="8" align="center">ID</td><td colspan="16" align="center"> </td></tr></tbody></table></div></div><br class="table-break"><div class="variablelist"><dl><dt><span class="term">Next Header Type</span></dt><dd><p>Specify what header type will follow in the current
              PDU.</p></dd><dt><span class="term">Size</span></dt><dd><p>The size of the fragment.</p></dd><dt><span class="term">ID</span></dt><dd><p>Fragment ID.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2621970"></a>6.1.1.4 PTP Connection Manager Control Header</h4></div></div></div><div class="table"><a name="id2621976"></a><p class="title"><b>Table 6.5 PTP_CM Control Header</b></p><div class="table-contents"><table summary="PTP_CM Control Header" cellpadding="5" border="1"><colgroup><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col></colgroup><tbody><tr><td><sup>0</sup></td><td><sup>1</sup></td><td><sup>2</sup></td><td><sup>3</sup></td><td><sup>4</sup></td><td><sup>5</sup></td><td><sup>6</sup></td><td><sup>7</sup></td><td><sup>8</sup></td><td><sup>9</sup></td><td><sup>10</sup></td><td><sup>11</sup></td><td><sup>12</sup></td><td><sup>13</sup></td><td><sup>14</sup></td><td><sup>15</sup></td><td><sup>16</sup></td><td><sup>17</sup></td><td><sup>18</sup></td><td><sup>19</sup></td><td><sup>20</sup></td><td><sup>21</sup></td><td><sup>22</sup></td><td><sup>23</sup></td><td><sup>24</sup></td><td><sup>25</sup></td><td><sup>26</sup></td><td><sup>27</sup></td><td><sup>28</sup></td><td><sup>29</sup></td><td><sup>30</sup></td><td><sup>31</sup></td></tr><tr><td colspan="8" align="center">0</td><td colspan="8" align="center">1</td><td colspan="8" align="center">2</td><td colspan="8" align="center">3</td></tr><tr><td colspan="8">Next Header Type</td><td colspan="16" align="center">CM
                Version</td><td colspan="8" align="center"> </td></tr></tbody></table></div></div><br class="table-break"><div class="variablelist"><dl><dt><span class="term">Next Header Type</span></dt><dd><p>Type for next packet in PDU. Currently it is PTP_CM_NONE
              only.</p></dd><dt><span class="term">CM Version</span></dt><dd><p>Connection Manager version</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2622431"></a>6.1.1.5 PTP Connection Protocol Description</h4></div></div></div><p>Unless a Connection Manager has been configured to create a
        connection to a peer, no messages are sent and the Connection Manager
        does not respond to connection attempts. Below is described one case
        when a connection is created and B side initiates the connection later
        then A side.</p><div class="figure"><a name="id2622445"></a><p class="title"><b>Figure 6.1 Connect Sequence diagram for PTP Connection Manager</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/linxprotocols-ptp-connect.png" alt="Connect Sequence diagram for PTP Connection Manager"></div></div></div><br class="figure-break"><h5><a name="id2622482"></a>A-side</h5><div class="procedure"><ul><li><p>When a Connection Object is created, A moves from
            DISCONNECTED state to CONNECTING, then sends a PTP_CM_CONN_CONNECT
            to B.</p><div class="orderedlist"><ol type="a" compact><li><p>If B replies with a PTP_CM_CONN_RESET PDU, A remains in
                CONNECTING state.</p></li><li><p>If B sends a PTP_CM_CONN_CONNECT PDU, A moves to
                CONNECTED state, sends PTP_CM_CONN_CONNECT_ACK PDU to B and
                notifies RLNH that a connection have been established.</p></li><li><p>If PTP_CM_CONN_RESET or PTP_CM_CONN_CONNECT PDUs are
                received, while in CONNECTED state, A side returns to
                disconnected state.</p></li></ol></div></li></ul></div><h5><a name="id2622540"></a>B-side</h5><div class="procedure"><ol type="1"><li><p>In DISCONNECTED state, B does not evolve from this state
            unless a local attempt to create a connection is made.</p></li><li><p>When a Connection Object is created, B moves from
            DISCONNECTED state to CONNECTING and sends a PTP_CM_CONN_CONNECT
            to A.</p><div class="orderedlist"><ol type="a" compact><li><p>When PTP_CM_CONN_CONNECT arrives, A is waiting already
                in CONNECTING state so it enters CONNECTED state and responds
                to B with PTP_CM_CONN_CONNECT_ACK.</p></li><li><p>When receiving PTP_CM_CONN_CONNECT_ACK, B side enters in
                CONNECTED state too.</p></li><li><p>If PTP_CM_CONN_RESET or PTP_CM_CONN_CONNECT PDUs are
                received while in CONNECTED state, B side returns to
                disconnected state</p></li></ol></div></li></ol></div><p>If either sides receive PTP_CM_CONN_CONNECT message while in
        CONNECTED state, it moves to DISCONNECTED and sends a
        PTP_CM_CONN_RESET message.</p><div class="figure"><a name="id2622613"></a><p class="title"><b>Figure 6.2 State diagram for PTP Connection Manager</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/linxprotocols-ptp-connectstates.png" alt="State diagram for PTP Connection Manager"></div></div></div><br class="figure-break"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ptp_cm-proto-supervision"></a>6.1.2 PTP Connection Supervision Protocol</h3></div></div></div><p>The purpose of Supervision <a class="indexterm" name="id2622665"></a>function is to detect crashed on peer side. In order to do
      that, PTP_CM_HEARTBEAT PDU is sent periodically to the other side. When
      a PTP_CM_HEARTBEAT_ACK is received, an internal counter is re-set. If no
      acknowledgement is received within a certain time interval, the
      heartbeat counter is decremented. After a number of ACK missed, the
      connection is considered crashed and will be disconnected. The timeout
      and the number of acknowledgments are configurable.</p><p>The supervision activity is independent of user data flow over the
      connection. Each side is responsible to detect peer's activity, and each
      side will request acknowledgment to own heartbeat messages.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ptp_cm_manager.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ptp_cm_manager.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="tcp_cm_manager.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"><b>6. Enea LINX Point-To-Point (PTP) Connection Manager</b> </td><td width="20%" align="center"><a accesskey="h" href="title.html">Home</a> | <a accesskey="i" href="ix01.html">Index</a></td><td width="40%" align="right" valign="top"> <b>7. Enea LINX TCP Connection Manager</b></td></tr><tr> </tr><tr><td colspan="3" align="center">© Enea Software AB 2011</td></tr></table></div></body></html>
